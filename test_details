require("dotenv").config();

const fetch = require("node-fetch");
const base = "https://api.odcloud.kr/api/gov24/v1/";
const API_AUTH_KEY = process.env.API_AUTH_KEY;
const fs = require("fs");

async function fetchFromApi(url) {
  const response = await fetch(url);
  const result = await response.json();

  // assert(response.status === 200, jsonOut.msg);

  return result;
}

async function main() {
  const conditions = JSON.parse(fs.readFileSync("conditions.json"));
  let result = [];

  const url = new URL("serviceDetail", base);
  for (let i = 0; i < conditions.length; ++i) {
    url.search = new URLSearchParams({
      page: 1,
      perPage: 1,
      "cond[SVC_ID::EQ]": conditions[i].SVC_ID,
      serviceKey: API_AUTH_KEY,
    });

    const body = await fetchFromApi(url);
    result.push({
      SVC_ID: conditions[i].SVC_ID,
      name: body.data[0]["서비스명"],
    });
  }

  fs.writeFileSync("conditionsName.json", JSON.stringify(result));
}

//main();

const conditions = JSON.parse(fs.readFileSync("conditions.json"));
const properties = [
  "JA0103",
  "JA0104",
  "JA0105",
  "JA0106",
  "JA0107",
  "JA0108",
  "JA0109",
];
for (let i = 0; i < conditions.length; ++i) {
  properties.forEach((p) => {
    if (conditions[i][p] !== null) {
      console.log(conditions[i]);
    }
  });
}
